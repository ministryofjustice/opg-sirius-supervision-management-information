services:
  management-information:
    image: 311462405659.dkr.ecr.eu-west-1.amazonaws.com/sirius/sirius-management-information:latest
    build:
      dockerfile: docker/management-information/Dockerfile
    ports:
      - "7777:7777"
    environment:
      PORT: 7777
      PREFIX: /management-information
    healthcheck:
      test: wget -O /dev/null -S 'http://localhost:7777/management-information/health-check' 2>&1 | grep 'HTTP/1.1 200 OK' || exit 1
      interval: 15s
      timeout: 10s
      retries: 3
      start_period: 30s

  cypress:
    build:
      dockerfile: docker/cypress/Dockerfile
    command: [ "--headless", "-b", "electron" ]
    volumes:
      - ./cypress/screenshots:/root/cypress/screenshots:rw,delegated
      - ./cypress/logs:/root/cypress/logs:rw,delegated
    depends_on:
      management-information:
        condition: service_healthy

  go-lint:
    image: golangci/golangci-lint:v1.54.2
    working_dir: /go/src/app
    volumes:
      - ./:/go/src/app
      - ./.cache/golangci-lint/v1.53.3:/root/.cache
    command: golangci-lint run -v --timeout 5m

  yarn:
    image: node:20-alpine3.19
    working_dir: /home/node/app
    entrypoint: yarn
    volumes:
      - ./:/home/node/app